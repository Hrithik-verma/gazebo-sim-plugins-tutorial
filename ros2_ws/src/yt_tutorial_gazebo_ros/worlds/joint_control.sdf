<?xml version='1.0'?>

<sdf version='1.9'>
<world name='joint_control_world'>


<!-- Essential systems normally coming from server.config -->
<!-- without these gz sim gui will be blank-->
<plugin filename="gz-sim-physics-system"
        name="gz::sim::systems::Physics">
</plugin>

<plugin filename="gz-sim-user-commands-system"
        name="gz::sim::systems::UserCommands">
</plugin>

<plugin filename="gz-sim-scene-broadcaster-system"
        name="gz::sim::systems::SceneBroadcaster">
</plugin>



<!-- Floor Plane -->
<model name="ground_plane">
    <static>true</static>
    <link name="link">
    <collision name="collision">
        <geometry>
        <plane>
            <normal>0 0 1</normal>
            <size>100 100</size>
        </plane>
        </geometry>
    </collision>
    <visual name="visual">
        <geometry>
        <plane>
            <normal>0 0 1</normal>
            <size>100 100</size>
        </plane>
        </geometry>
        <material>
        <ambient>0.8 0.8 0.8 1</ambient>
        <diffuse>0.8 0.8 0.8 1</diffuse>
        <specular>0.8 0.8 0.8 1</specular>
        </material>
    </visual>
    </link>
</model>


<model name="mega_t_joint_fixed">
  <pose>0 0 0 0 0 0</pose>

  <!-- BASE -->
  <link name="link_base">
    <pose>0 0 1.0 0 0 0</pose>
    <visual name="visual">
      <geometry><box><size>30 30 2.0</size></box></geometry>
      <material>
        <script>
          <uri>file://media/materials/scripts/gazebo.material</uri>
          <name>Gazebo/DarkGrey</name>
        </script>
      </material>
    </visual>
    <collision name="collision">
      <geometry><box><size>30 30 2.0</size></box></geometry>
    </collision>
  </link>

  <!-- POST -->
  <link name="link_post">
    <pose>0 0 11.0 0 0 0</pose>
    <visual name="visual">
      <geometry><cylinder><radius>2.0</radius><length>18.0</length></cylinder></geometry>
      <material>
        <script>
          <uri>file://media/materials/scripts/gazebo.material</uri>
          <name>Gazebo/Green</name>
        </script>
      </material>
    </visual>
    <collision name="collision">
      <geometry><cylinder><radius>2.0</radius><length>18.0</length></cylinder></geometry>
    </collision>
  </link>

  <!-- BAR (link frame placed at the JOINT anchor) -->
  <link name="link_bar">
    <!-- Put the link frame exactly at the joint: top of post -->
    <pose>0 0 20.0 0 0 0</pose>

    <visual name="visual">
      <!-- Rotate cylinder to lie along +Y; keep it centered at the link frame -->
      <pose>0 0 0 -1.5708 0 0</pose>
      <geometry><cylinder><radius>1.5</radius><length>26.0</length></cylinder></geometry>
      <material>
        <script>
          <uri>file://media/materials/scripts/gazebo.material</uri>
          <name>Gazebo/Blue</name>
        </script>
      </material>
    </visual>

    <collision name="collision">
      <pose>0 0 0 -1.5708 0 0</pose>
      <geometry><cylinder><radius>1.5</radius><length>26.0</length></cylinder></geometry>
    </collision>
  </link>

  <!-- JOINTS -->
  <joint name="joint_0" type="fixed">
    <parent>link_base</parent>
    <child>link_post</child>
    <pose>0 0 -5.0 0 0 0</pose>
  </joint>

  <joint name="joint_1" type="revolute">
    <parent>link_post</parent>
    <child>link_bar</child>

    <!-- Joint anchor at top of post (same as link_bar pose) -->
    <pose>0 0 0.4 0 0 0</pose>

    <axis>
      <xyz>0 0 1</xyz>
      <limit>
        <lower>-1.79769e+308</lower>
        <upper>1.79769e+308</upper>
        <effort>5000</effort>
        <velocity>1.0</velocity>
      </limit>
      <dynamics><damping>10.0</damping></dynamics>
    </axis>
  </joint>

  <static>0</static>

  <plugin filename="JointControl" name="gz::sim::JointControl">
    <joint_name>joint_1</joint_name>

    <!-- posssible mode: 
          velocity
          force
          position
    -->
    <mode>velocity</mode>
    
    <!-- velocity mode (rad/sec)-->
    <cmd_vel>1.0</cmd_vel>

    <!-- force mode (Nm)-->
    <cmd_torque>15.0</cmd_torque>

    <!--position mode (radian)-->
    <pos_a>0.523599</pos_a> <!-- 30 deg-->
    <pos_b>2.0944</pos_b> <!-- 120 deg-->
    <wait_time>6</wait_time>
    <!-- PD control-->
    <p_gain>10.0</p_gain>
    <d_gain>1.0</d_gain>
    <max_torque>10.0</max_torque>
    <pos_tolerence>0.1</pos_tolerence>
  </plugin>
</model>

</world>
</sdf>